#include <stdio.h>
#include <stdlib.h>
#include <time.h>

int PII_Invert_6x6(float *src) {
  float d, di;
  di = src[0];
  src[0] = d = 1.0f / di;
  src[6] *= -d;
  src[12] *= -d;
  src[18] *= -d;
  src[24] *= -d;
  src[30] *= -d;
  src[1] *= d;
  src[2] *= d;
  src[3] *= d;
  src[4] *= d;
  src[5] *= d;
  src[7] += src[6] * src[1] * di;
  src[8] += src[6] * src[2] * di;
  src[9] += src[6] * src[3] * di;
  src[10] += src[6] * src[4] * di;
  src[11] += src[6] * src[5] * di;
  src[13] += src[12] * src[1] * di;
  src[14] += src[12] * src[2] * di;
  src[15] += src[12] * src[3] * di;
  src[16] += src[12] * src[4] * di;
  src[17] += src[12] * src[5] * di;
  src[19] += src[18] * src[1] * di;
  src[20] += src[18] * src[2] * di;
  src[21] += src[18] * src[3] * di;
  src[22] += src[18] * src[4] * di;
  src[23] += src[18] * src[5] * di;
  src[25] += src[24] * src[1] * di;
  src[26] += src[24] * src[2] * di;
  src[27] += src[24] * src[3] * di;
  src[28] += src[24] * src[4] * di;
  src[29] += src[24] * src[5] * di;
  src[31] += src[30] * src[1] * di;
  src[32] += src[30] * src[2] * di;
  src[33] += src[30] * src[3] * di;
  src[34] += src[30] * src[4] * di;
  src[35] += src[30] * src[5] * di;
  di = src[7];
  src[7] = d = 1.0f / di;
  src[1] *= -d;
  src[13] *= -d;
  src[19] *= -d;
  src[25] *= -d;
  src[31] *= -d;
  src[6] *= d;
  src[8] *= d;
  src[9] *= d;
  src[10] *= d;
  src[11] *= d;
  src[0] += src[1] * src[6] * di;
  src[2] += src[1] * src[8] * di;
  src[3] += src[1] * src[9] * di;
  src[4] += src[1] * src[10] * di;
  src[5] += src[1] * src[11] * di;
  src[12] += src[13] * src[6] * di;
  src[14] += src[13] * src[8] * di;
  src[15] += src[13] * src[9] * di;
  src[16] += src[13] * src[10] * di;
  src[17] += src[13] * src[11] * di;
  src[18] += src[19] * src[6] * di;
  src[20] += src[19] * src[8] * di;
  src[21] += src[19] * src[9] * di;
  src[22] += src[19] * src[10] * di;
  src[23] += src[19] * src[11] * di;
  src[24] += src[25] * src[6] * di;
  src[26] += src[25] * src[8] * di;
  src[27] += src[25] * src[9] * di;
  src[28] += src[25] * src[10] * di;
  src[29] += src[25] * src[11] * di;
  src[30] += src[31] * src[6] * di;
  src[32] += src[31] * src[8] * di;
  src[33] += src[31] * src[9] * di;
  src[34] += src[31] * src[10] * di;
  src[35] += src[31] * src[11] * di;
  di = src[14];
  src[14] = d = 1.0f / di;
  src[2] *= -d;
  src[8] *= -d;
  src[20] *= -d;
  src[26] *= -d;
  src[32] *= -d;
  src[12] *= d;
  src[13] *= d;
  src[15] *= d;
  src[16] *= d;
  src[17] *= d;
  src[0] += src[2] * src[12] * di;
  src[1] += src[2] * src[13] * di;
  src[3] += src[2] * src[15] * di;
  src[4] += src[2] * src[16] * di;
  src[5] += src[2] * src[17] * di;
  src[6] += src[8] * src[12] * di;
  src[7] += src[8] * src[13] * di;
  src[9] += src[8] * src[15] * di;
  src[10] += src[8] * src[16] * di;
  src[11] += src[8] * src[17] * di;
  src[18] += src[20] * src[12] * di;
  src[19] += src[20] * src[13] * di;
  src[21] += src[20] * src[15] * di;
  src[22] += src[20] * src[16] * di;
  src[23] += src[20] * src[17] * di;
  src[24] += src[26] * src[12] * di;
  src[25] += src[26] * src[13] * di;
  src[27] += src[26] * src[15] * di;
  src[28] += src[26] * src[16] * di;
  src[29] += src[26] * src[17] * di;
  src[30] += src[32] * src[12] * di;
  src[31] += src[32] * src[13] * di;
  src[33] += src[32] * src[15] * di;
  src[34] += src[32] * src[16] * di;
  src[35] += src[32] * src[17] * di;
  di = src[21];
  src[21] = d = 1.0f / di;
  src[3] *= -d;
  src[9] *= -d;
  src[15] *= -d;
  src[27] *= -d;
  src[33] *= -d;
  src[18] *= d;
  src[19] *= d;
  src[20] *= d;
  src[22] *= d;
  src[23] *= d;
  src[0] += src[3] * src[18] * di;
  src[1] += src[3] * src[19] * di;
  src[2] += src[3] * src[20] * di;
  src[4] += src[3] * src[22] * di;
  src[5] += src[3] * src[23] * di;
  src[6] += src[9] * src[18] * di;
  src[7] += src[9] * src[19] * di;
  src[8] += src[9] * src[20] * di;
  src[10] += src[9] * src[22] * di;
  src[11] += src[9] * src[23] * di;
  src[12] += src[15] * src[18] * di;
  src[13] += src[15] * src[19] * di;
  src[14] += src[15] * src[20] * di;
  src[16] += src[15] * src[22] * di;
  src[17] += src[15] * src[23] * di;
  src[24] += src[27] * src[18] * di;
  src[25] += src[27] * src[19] * di;
  src[26] += src[27] * src[20] * di;
  src[28] += src[27] * src[22] * di;
  src[29] += src[27] * src[23] * di;
  src[30] += src[33] * src[18] * di;
  src[31] += src[33] * src[19] * di;
  src[32] += src[33] * src[20] * di;
  src[34] += src[33] * src[22] * di;
  src[35] += src[33] * src[23] * di;
  di = src[28];
  src[28] = d = 1.0f / di;
  src[4] *= -d;
  src[10] *= -d;
  src[16] *= -d;
  src[22] *= -d;
  src[34] *= -d;
  src[24] *= d;
  src[25] *= d;
  src[26] *= d;
  src[27] *= d;
  src[29] *= d;
  src[0] += src[4] * src[24] * di;
  src[1] += src[4] * src[25] * di;
  src[2] += src[4] * src[26] * di;
  src[3] += src[4] * src[27] * di;
  src[5] += src[4] * src[29] * di;
  src[6] += src[10] * src[24] * di;
  src[7] += src[10] * src[25] * di;
  src[8] += src[10] * src[26] * di;
  src[9] += src[10] * src[27] * di;
  src[11] += src[10] * src[29] * di;
  src[12] += src[16] * src[24] * di;
  src[13] += src[16] * src[25] * di;
  src[14] += src[16] * src[26] * di;
  src[15] += src[16] * src[27] * di;
  src[17] += src[16] * src[29] * di;
  src[18] += src[22] * src[24] * di;
  src[19] += src[22] * src[25] * di;
  src[20] += src[22] * src[26] * di;
  src[21] += src[22] * src[27] * di;
  src[23] += src[22] * src[29] * di;
  src[30] += src[34] * src[24] * di;
  src[31] += src[34] * src[25] * di;
  src[32] += src[34] * src[26] * di;
  src[33] += src[34] * src[27] * di;
  src[35] += src[34] * src[29] * di;
  di = src[35];
  src[35] = d = 1.0f / di;
  src[5] *= -d;
  src[11] *= -d;
  src[17] *= -d;
  src[23] *= -d;
  src[29] *= -d;
  src[30] *= d;
  src[31] *= d;
  src[32] *= d;
  src[33] *= d;
  src[34] *= d;
  src[0] += src[5] * src[30] * di;
  src[1] += src[5] * src[31] * di;
  src[2] += src[5] * src[32] * di;
  src[3] += src[5] * src[33] * di;
  src[4] += src[5] * src[34] * di;
  src[6] += src[11] * src[30] * di;
  src[7] += src[11] * src[31] * di;
  src[8] += src[11] * src[32] * di;
  src[9] += src[11] * src[33] * di;
  src[10] += src[11] * src[34] * di;
  src[12] += src[17] * src[30] * di;
  src[13] += src[17] * src[31] * di;
  src[14] += src[17] * src[32] * di;
  src[15] += src[17] * src[33] * di;
  src[16] += src[17] * src[34] * di;
  src[18] += src[23] * src[30] * di;
  src[19] += src[23] * src[31] * di;
  src[20] += src[23] * src[32] * di;
  src[21] += src[23] * src[33] * di;
  src[22] += src[23] * src[34] * di;
  src[24] += src[29] * src[30] * di;
  src[25] += src[29] * src[31] * di;
  src[26] += src[29] * src[32] * di;
  src[27] += src[29] * src[33] * di;
  src[28] += src[29] * src[34] * di;
  return 1; // always, even when there is no A^-1.
}

int main(int argc, char const *argv[]) {
  float matrix[6][6] = {{1, 0, 0, 0, 0, 0}, {0, 1, 0, 0, 0, 0},
                        {0, 0, 1, 0, 0, 0}, {0, 0, 0, 1, 0, 0},
                        {0, 0, 0, 0, 3, 0}, {0, 0, 0, 0, 0, 2}};
  srand(time(NULL));
  printf("before invert\n");
  for (int i = 0; i < 6; ++i) {
    for (int j = 0; j < 6; ++j) {
      printf("%f ", matrix[i][j]);
    }
    printf("\n");
  }
  clock_t t;
  t = clock();
  for (int i = 0; i < 1000; ++i) {
    int r = rand();
    int m = r % 6;
    matrix[m][m] = (float)r / RAND_MAX + 1;
    PII_Invert_6x6(*matrix);
  }
  t = clock() - t;
  double time_taken = ((double)t) / CLOCKS_PER_SEC; // in seconds
  printf("took %f seconds to execute \n", time_taken);

  printf("after invert\n");
  for (int i = 0; i < 6; ++i) {
    for (int j = 0; j < 6; ++j) {
      printf("%f ", matrix[i][j]);
    }
    printf("\n");
  }
  return 0;
}